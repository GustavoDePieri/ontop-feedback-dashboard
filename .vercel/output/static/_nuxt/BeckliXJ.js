import{u as Y,a as W,b as J,_ as q}from"./BvCE-nWt.js";import{r as g,E as D,e as K,i as Q,c,a as e,j as b,G as X,b as L,w as T,u as r,q as R,k as x,v as S,l as Z,s as ee,y as U,t as h,d as i,B as te,o as u,F as se,m as oe}from"#entry";import{u as ne}from"./CeJfwST1.js";const re=()=>{const C=g([]),w=g(!1),f=g(null),k=g(null),y=async()=>{w.value=!0,f.value=null;try{const l=await $fetch("/api/sheets/data");C.value=l.data,k.value=l.lastUpdated}catch(l){f.value=l.message||"Failed to fetch data",console.error("Error fetching Google Sheets data:",l)}finally{w.value=!1}},p=async()=>{try{return await $fetch("/api/sheets/test")}catch(l){throw new Error(`Connection test failed: ${l.message}`)}},v=async()=>{await y()};return{data:D(C),loading:D(w),error:D(f),lastUpdated:D(k),fetchData:y,testConnection:p,refreshData:v}},ae={class:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-purple-50/20 dark:from-slate-950 dark:via-slate-900 dark:to-slate-900"},le={class:"bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 shadow-xl"},ie={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},de={class:"flex justify-between items-center py-8"},ue={class:"flex space-x-3"},ce={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},pe={class:"px-6 py-4 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/50"},me={class:"flex items-center justify-between"},he={class:"text-sm text-white"},ge={class:"p-6"},xe={key:0,class:"text-center py-12"},ve={class:"mt-6"},we={key:1,class:"space-y-4"},fe=["onClick"],be={class:"flex items-center space-x-4 flex-1"},ke={class:"flex-1"},ye={class:"text-base font-bold text-white group-hover:text-blue-400 transition-colors"},De={class:"text-sm text-white mt-1"},Re={class:"text-xs text-white mt-1"},Ce={class:"flex items-center space-x-3"},Me={class:"hidden sm:flex items-center space-x-4 mr-4"},Ae={class:"text-center"},Ie={class:"text-sm font-bold text-green-600 dark:text-green-400"},_e={class:"text-center"},Se={class:"text-sm font-bold text-red-600 dark:text-red-400"},Ue={key:0,class:"text-center"},Ve=["onClick"],je=["onClick"],$e={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0"},Be={class:"bg-gradient-ontop-hero px-6 py-4"},Le={class:"flex items-center justify-between"},Te={class:"px-6 py-6 space-y-6"},He={key:0,class:"grid grid-cols-2 gap-4"},Ee={class:"space-y-3"},Fe={class:"flex items-center space-x-3 cursor-pointer"},Ge={class:"flex items-center space-x-3 cursor-pointer"},Ne={class:"flex items-center space-x-3 cursor-pointer"},ze={class:"bg-white/5 border border-white/10 rounded-lg p-4"},Pe={class:"flex items-start"},Oe={class:"flex-1"},Ye={class:"text-sm text-white font-medium"},We={key:0,class:"text-xs text-white mt-1"},Je={class:"bg-white/5 px-6 py-4 flex justify-end space-x-3"},qe=["disabled"],Ke={key:0,class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Qe={key:1,class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"},tt=K({__name:"reports",setup(C){ne({title:"Unified Reports - Ontop Feedback Analytics",meta:[{name:"description",content:"Generate comprehensive unified reports with AI insights"}]});const{fetchFeedbackData:w}=re(),{generateWeeklyReport:f}=W(),{generateExecutiveHTML:k}=J(),{generateRecommendations:y}=Y(),p=g(!1),v=g(!1),l=g(!1),M=g(""),n=g({title:"Unified Intelligence Report",period:"last-week",startDate:"",endDate:"",includeAI:!0,includeManager:!0,includeAccounts:!0}),d=g([]);Q(()=>{H()});const H=()=>{try{const s=localStorage.getItem("unified_reports");s&&(d.value=JSON.parse(s))}catch(s){console.error("Error loading reports:",s)}},V=()=>{try{localStorage.setItem("unified_reports",JSON.stringify(d.value))}catch(s){console.error("Error saving reports:",s)}},A=()=>{const s=new Date;let t,a;switch(n.value.period){case"today":t=new Date(s.getFullYear(),s.getMonth(),s.getDate()),a=new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59);break;case"yesterday":t=new Date(s),t.setDate(s.getDate()-1),t.setHours(0,0,0,0),a=new Date(s),a.setDate(s.getDate()-1),a.setHours(23,59,59,999);break;case"this-week":t=new Date(s),t.setDate(s.getDate()-s.getDay()),t.setHours(0,0,0,0),a=new Date(s);break;case"last-week":t=new Date(s),t.setDate(s.getDate()-s.getDay()-7),t.setHours(0,0,0,0),a=new Date(s),a.setDate(s.getDate()-s.getDay()-1),a.setHours(23,59,59,999);break;case"this-month":t=new Date(s.getFullYear(),s.getMonth(),1),a=new Date(s);break;case"last-month":t=new Date(s.getFullYear(),s.getMonth()-1,1),a=new Date(s.getFullYear(),s.getMonth(),0,23,59,59);break;case"last-30-days":t=new Date(s),t.setDate(s.getDate()-30),t.setHours(0,0,0,0),a=new Date(s);break;case"last-90-days":t=new Date(s),t.setDate(s.getDate()-90),t.setHours(0,0,0,0),a=new Date(s);break;default:return}n.value.startDate=t.toISOString().split("T")[0],n.value.endDate=a.toISOString().split("T")[0]},E=()=>n.value.period==="custom"?`${n.value.startDate} to ${n.value.endDate}`:{today:"today",yesterday:"yesterday","this-week":"this week","last-week":"last week","this-month":"this month","last-month":"last month","last-30-days":"the last 30 days","last-90-days":"the last 90 days"}[n.value.period]||"selected period",F=async()=>{l.value=!0;try{const s=await w();A();const t=new Date(n.value.startDate),a=new Date(n.value.endDate),m=s.filter(_=>{const B=new Date(_.createdDate);return B>=t&&B<=a});if(m.length===0){alert("No feedback found in the selected date range"),l.value=!1;return}const o=f(m,0);o.title=n.value.title||"Unified Intelligence Report";let I=null;if(n.value.includeAI)try{await y(m,{segmentType:"all",focusArea:"recurring patterns and actionable insights"})}catch(_){console.error("AI generation failed:",_)}const $=k(o);M.value=$;const O={id:Date.now(),title:n.value.title,dateRange:`${j(t)} - ${j(a)}`,feedbackCount:m.length,generatedAt:new Date,html:$,hasAIInsights:n.value.includeAI,stats:{positive:o.summary.positivePercent,negative:o.summary.negativePercent,neutral:o.summary.neutralPercent}};d.value.unshift(O),d.value.length>10&&(d.value=d.value.slice(0,10)),V(),p.value=!1,v.value=!0}catch(s){console.error("Error generating report:",s),alert("Failed to generate report. Please try again.")}finally{l.value=!1}},G=s=>{M.value=s.html,v.value=!0},N=s=>{const t=new Blob([s.html],{type:"text/html"}),a=URL.createObjectURL(t),m=document.createElement("a");m.href=a,m.download=`${s.title.replace(/\s+/g,"_")}_${s.id}.html`,m.click(),URL.revokeObjectURL(a)},z=s=>{confirm("Are you sure you want to delete this report?")&&(d.value=d.value.filter(t=>t.id!==s),V())},P=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),j=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return A(),(s,t)=>{const a=te("AppCard"),m=q;return u(),c("div",ae,[e("header",le,[e("div",ie,[e("div",de,[t[16]||(t[16]=e("div",null,[e("h1",{class:"text-3xl font-bold text-white drop-shadow-lg"}," ðŸ“Š Unified Intelligence Reports "),e("p",{class:"mt-2 text-blue-100 font-medium drop-shadow"}," Comprehensive reports with AI-powered insights ")],-1)),e("div",ue,[e("button",{onClick:t[0]||(t[0]=o=>p.value=!0),class:"bg-white/20 hover:bg-white/30 backdrop-blur-md text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 shadow-lg hover:shadow-2xl transform hover:scale-105 flex items-center space-x-2"},[...t[15]||(t[15]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("span",null,"Generate New Report",-1)])])])])])]),e("main",ce,[L(a,{class:"mb-6 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-l-4 border-blue-600"},{default:T(()=>[...t[17]||(t[17]=[e("div",{class:"p-6"},[e("div",{class:"flex items-start"},[e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])]),e("div",{class:"ml-4 flex-1"},[e("h3",{class:"text-lg font-bold text-white mb-2"}," ðŸŽ¯ New Unified Report System "),e("p",{class:"text-white text-sm leading-relaxed"},[i(" All report types have been merged into "),e("strong",null,"one comprehensive report"),i(" that includes: "),e("span",{class:"block mt-2 space-y-1"},[i(" â€¢ "),e("strong",null,"AI-Powered Insights"),i(" - Recurring patterns and recommendations"),e("br"),i(" â€¢ "),e("strong",null,"Executive Summary"),i(" - Key metrics and trends"),e("br"),i(" â€¢ "),e("strong",null,"Detailed Analysis"),i(" - By category, account, and manager"),e("br"),i(" â€¢ "),e("strong",null,"Custom Time Periods"),i(" - Analyze any date range you want ")])])])])],-1)])]),_:1}),L(a,{class:"mb-8"},{default:T(()=>[e("div",pe,[e("div",me,[t[18]||(t[18]=e("h3",{class:"text-lg font-bold text-white"},"ðŸ“ Recent Reports",-1)),e("span",he,h(r(d).length)+" report"+h(r(d).length!==1?"s":"")+" generated ",1)])]),e("div",ge,[r(d).length===0?(u(),c("div",xe,[t[20]||(t[20]=e("svg",{class:"mx-auto h-12 w-12 text-white/50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),t[21]||(t[21]=e("h3",{class:"mt-2 text-sm font-medium text-white"},"No reports yet",-1)),t[22]||(t[22]=e("p",{class:"mt-1 text-sm text-white"},"Get started by generating your first unified report.",-1)),e("div",ve,[e("button",{onClick:t[1]||(t[1]=o=>p.value=!0),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"},[...t[19]||(t[19]=[e("svg",{class:"-ml-1 mr-2 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),i(" Generate Report ",-1)])])])])):(u(),c("div",we,[(u(!0),c(se,null,oe(r(d),o=>(u(),c("div",{key:o.id,class:"group relative flex items-center justify-between p-4 bg-white dark:bg-slate-800 rounded-lg border-2 border-gray-200 dark:border-slate-700 hover:border-blue-500 dark:hover:border-blue-500 hover:shadow-lg transition-all duration-200 cursor-pointer",onClick:I=>G(o)},[e("div",be,[t[23]||(t[23]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-lg"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})])])],-1)),e("div",ke,[e("h4",ye,h(o.title),1),e("p",De,h(o.dateRange)+" â€¢ "+h(o.feedbackCount)+" feedback items ",1),e("p",Re," Generated "+h(P(o.generatedAt)),1)])]),e("div",Ce,[e("div",Me,[e("div",Ae,[e("div",Ie,h(o.stats.positive)+"%",1),t[24]||(t[24]=e("div",{class:"text-xs text-white"},"Positive",-1))]),e("div",_e,[e("div",Se,h(o.stats.negative)+"%",1),t[25]||(t[25]=e("div",{class:"text-xs text-white"},"Negative",-1))]),o.hasAIInsights?(u(),c("div",Ue,[...t[26]||(t[26]=[e("div",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300"},[e("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})]),i(" AI Insights ")],-1)])])):b("",!0)]),e("button",{onClick:R(I=>N(o),["stop"]),class:"p-2 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",title:"Download Report"},[...t[27]||(t[27]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,Ve),e("button",{onClick:R(I=>z(o.id),["stop"]),class:"p-2 text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:"Delete Report"},[...t[28]||(t[28]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,je)])],8,fe))),128))]))])]),_:1})]),r(p)?(u(),c("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:t[13]||(t[13]=R(o=>p.value=!1,["self"]))},[e("div",$e,[e("div",{class:"fixed inset-0 transition-opacity bg-black/75",onClick:t[2]||(t[2]=o=>p.value=!1)}),t[42]||(t[42]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen"},"â€‹",-1)),e("div",{class:"inline-block align-bottom bg-ontop-navy-dark rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full border border-white/10",onClick:t[12]||(t[12]=R(()=>{},["stop"]))},[e("div",Be,[e("div",Le,[t[30]||(t[30]=e("div",null,[e("h3",{class:"text-xl font-bold text-white"},"Generate Unified Report"),e("p",{class:"text-sm text-white mt-1"},"Select time period and options")],-1)),e("button",{onClick:t[3]||(t[3]=o=>p.value=!1),class:"text-white/80 hover:text-white transition-colors"},[...t[29]||(t[29]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",Te,[e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-white/80 mb-2"}," Report Title ",-1)),x(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>r(n).title=o),type:"text",placeholder:"e.g., Weekly Executive Report",class:"w-full border border-white/20 bg-white/10 text-white rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-ontop-coral-500 focus:border-ontop-coral-500 placeholder-white/50"},null,512),[[S,r(n).title]])]),e("div",null,[t[33]||(t[33]=e("label",{class:"block text-sm font-medium text-white/80 mb-2"}," Time Period ",-1)),x(e("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>r(n).period=o),onChange:A,class:"w-full border border-white/20 bg-white/10 text-white rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-ontop-coral-500 focus:border-ontop-coral-500"},[...t[32]||(t[32]=[ee('<option value="today">Today</option><option value="yesterday">Yesterday</option><option value="this-week">This Week</option><option value="last-week">Last Week</option><option value="this-month">This Month</option><option value="last-month">Last Month</option><option value="last-30-days">Last 30 Days</option><option value="last-90-days">Last 90 Days</option><option value="custom">Custom Range</option>',9)])],544),[[Z,r(n).period]])]),r(n).period==="custom"?(u(),c("div",He,[e("div",null,[t[34]||(t[34]=e("label",{class:"block text-sm font-medium text-white/80 mb-2"}," Start Date ",-1)),x(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>r(n).startDate=o),type:"date",class:"w-full border border-white/20 bg-white/10 text-white rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-ontop-coral-500 focus:border-ontop-coral-500"},null,512),[[S,r(n).startDate]])]),e("div",null,[t[35]||(t[35]=e("label",{class:"block text-sm font-medium text-white/80 mb-2"}," End Date ",-1)),x(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>r(n).endDate=o),type:"date",class:"w-full border border-white/20 bg-white/10 text-white rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-ontop-coral-500 focus:border-ontop-coral-500"},null,512),[[S,r(n).endDate]])])])):b("",!0),e("div",Ee,[t[39]||(t[39]=e("label",{class:"block text-sm font-medium text-white/80 mb-2"}," Report Options ",-1)),e("label",Fe,[x(e("input",{"onUpdate:modelValue":t[8]||(t[8]=o=>r(n).includeAI=o),type:"checkbox",class:"w-4 h-4 text-ontop-coral-500 border-white/20 bg-white/10 rounded focus:ring-ontop-coral-500"},null,512),[[U,r(n).includeAI]]),t[36]||(t[36]=e("div",{class:"flex-1"},[e("span",{class:"text-sm font-medium text-white"}," Include AI-Powered Insights "),e("p",{class:"text-xs text-white/60"}," Recurring patterns, recommendations, and trends ")],-1))]),e("label",Ge,[x(e("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>r(n).includeManager=o),type:"checkbox",class:"w-4 h-4 text-ontop-coral-500 border-white/20 bg-white/10 rounded focus:ring-ontop-coral-500"},null,512),[[U,r(n).includeManager]]),t[37]||(t[37]=e("div",{class:"flex-1"},[e("span",{class:"text-sm font-medium text-white"}," Include Manager Performance "),e("p",{class:"text-xs text-white/60"}," Breakdown by account manager ")],-1))]),e("label",Ne,[x(e("input",{"onUpdate:modelValue":t[10]||(t[10]=o=>r(n).includeAccounts=o),type:"checkbox",class:"w-4 h-4 text-ontop-coral-500 border-white/20 bg-white/10 rounded focus:ring-ontop-coral-500"},null,512),[[U,r(n).includeAccounts]]),t[38]||(t[38]=e("div",{class:"flex-1"},[e("span",{class:"text-sm font-medium text-white"}," Include Top Accounts Analysis "),e("p",{class:"text-xs text-white/60"}," Most active accounts and their sentiment ")],-1))])]),e("div",ze,[e("div",Pe,[t[40]||(t[40]=e("svg",{class:"w-5 h-5 text-white mt-0.5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",Oe,[e("p",Ye," Report will analyze feedback from "+h(E()),1),r(n).includeAI?(u(),c("p",We," AI analysis may take 10-20 seconds ")):b("",!0)])])])]),e("div",Je,[e("button",{onClick:t[11]||(t[11]=o=>p.value=!1),class:"px-4 py-2 border border-white/10 rounded-md text-sm font-medium text-white hover:bg-white/5 transition-colors"}," Cancel "),e("button",{onClick:F,disabled:r(l),class:"px-6 py-2 bg-gradient-cta hover:bg-gradient-cta-hover text-white font-medium rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed flex items-center"},[r(l)?(u(),c("div",Qe)):(u(),c("svg",Ke,[...t[41]||(t[41]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)])])),i(" "+h(r(l)?"Generating...":"Generate Report"),1)],8,qe)])])])])):b("",!0),r(v)?(u(),X(m,{key:1,reportHTML:r(M),onClose:t[14]||(t[14]=o=>v.value=!1)},null,8,["reportHTML"])):b("",!0)])}}});export{tt as default};
